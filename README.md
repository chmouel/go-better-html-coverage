# go-better-html-coverage

![Go](https://img.shields.io/badge/go-1.25%2B-blue)
![Coverage](https://img.shields.io/badge/Coverage-70.6%25-brightgreen)

A better HTML Go Coverage - Single-file HTML coverage reports for Go.

<img src="./.github/screenshots/better-html-go-coverage.png" width="800"/>

## Features

- Single self-contained HTML file
- File tree with search - `Ctrl+P`
- In-file search with highlighting - `Ctrl+F`
- Syntax highlighting.
- Deep linking to lines and ranges (click line numbers, shift+click for range)
- Sort by coverage.
- SVG badge generation for README/CI integration

## Install

### Homebrew (macOS)

```shell
brew tap chmouel/go-better-html-coverage https://github.com/chmouel/go-better-html-coverage
brew install go-better-html-coverage --cask
```

#### macOS Gatekeeper

macOS quarantines binaries downloaded from the internet. On first run you may
see "Apple could not verify go-better-html-coverage". To resolve this:

**Option 1:** Allow via System Settings

1. Open System Settings > Privacy & Security
2. Click "Open Anyway" next to the go-better-html-coverage warning

**Option 2:** Remove the quarantine attribute

```bash
xattr -d com.apple.quarantine /opt/homebrew/bin/go-better-html-coverage
```

### [Arch](https://aur.archlinux.org/packages/go-better-html-coverage-bin)

```shell
yay -S go-better-html-coverage-bin
```

### Manual

```bash
go install github.com/chmouel/go-better-html-coverage@latest
```

## Usage

```bash
go test -coverprofile=coverage.out ./...
go-better-html-coverage -profile coverage.out -o coverage.html
```

## Flags

Use `-profile` to specify the coverage file as generated by `go test
-coverprofile`.

By default the tool will output to the stdout unless `-o` is specified and then
it will try to open the file in the default browser unless `-n` is specified.

You can specify a `-src` flag to point to the root of your source code, it used
`.` as default.

If you want to filter the coverage report to only files changed in a git ref
you can specify the flag `-ref` with a git ref or range (e.g. `main` or
`main..HEAD`).

Use `-exclude` to exclude files matching regex patterns. This is useful for
filtering out mock files, generated code, or test files. The flag can be
repeated to specify multiple patterns:

```bash
go-better-html-coverage -profile coverage.out -exclude "mock_.*\.go$" -exclude "\.pb\.go$"
```

-q` is for quiet mode, it suppresses non-error output.

Use `-badge` to generate an SVG badge showing the coverage percentage. This is
useful for embedding in README files or CI/CD pipelines:

```bash
go-better-html-coverage -profile coverage.out -badge coverage-badge.svg
```

The badge color automatically changes based on coverage thresholds. By default:

- Red: 0-40%
- Yellow: 41-70%
- Green: 71-100%

You can customize the thresholds using `-badge-threshold` for example:

```bash
go-better-html-coverage -profile coverage.out -badge coverage-badge.svg -badge-threshold "50,85"
```

Would make: Red 0-50%, Yellow 51-84%, Green 85-100%.

You can also output the badge to stdout using `-badge -` and redirect it to a file.

See `-help` for all available flags.

## Copyright

[Apache-2.0](./LICENSE)

## Authors

### Chmouel Boudjnah

- Fediverse - <[@chmouel@chmouel.com](https://fosstodon.org/@chmouel)>
- Twitter - <[@chmouel](https://twitter.com/chmouel)>
- Blog  - <[https://blog.chmouel.com](https://blog.chmouel.com)>
